<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini | Killer King Neural</title>
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500&display=swap">
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    
    <style>
        :root {
            --bg: #131314;
            --sidebar: #1e1f20;
            --text: #e3e3e3;
            --blue: #8ab4f8;
            --hover: #333537;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Google Sans', sans-serif; }
        body { background: var(--bg); color: var(--text); height: 100vh; display: flex; overflow: hidden; }

        /* --- SIDEBAR --- */
        #side-nav {
            width: 280px; background: var(--sidebar); height: 100%; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex; flex-direction: column; padding: 15px; z-index: 1000;
        }
        #side-nav.collapsed { width: 0; padding: 0; margin-left: -280px; }

        .btn-new-chat {
            background: #1a1a1c; border-radius: 50px; padding: 14px 20px;
            display: flex; align-items: center; gap: 15px; cursor: pointer; color: #8e918f; border: 1px solid #333;
        }
        .btn-new-chat:hover { background: var(--hover); }

        .chat-history { flex: 1; margin-top: 25px; overflow-y: auto; }
        .history-item { 
            padding: 10px 15px; border-radius: 50px; font-size: 14px; cursor: pointer;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: flex; align-items: center; gap: 10px;
        }
        .history-item:hover { background: var(--hover); }

        /* --- MAIN VIEW --- */
        .main-view { flex: 1; display: flex; flex-direction: column; position: relative; }
        
        header { padding: 12px 20px; display: flex; align-items: center; justify-content: space-between; }
        .logo-box { display: flex; align-items: center; gap: 8px; font-size: 18px; font-weight: 500; }
        .gemini-sparkle { width: 22px; }

        .auth-btn {
            background: var(--blue); color: #004a77; padding: 8px 24px; border-radius: 50px;
            font-weight: 500; cursor: pointer; border: none; font-size: 14px;
        }
        .user-pfp { width: 34px; height: 34px; border-radius: 50%; cursor: pointer; display: none; border: 1px solid #444; }

        #chat-area {
            flex: 1; overflow-y: auto; padding: 40px 18% 180px;
            display: flex; flex-direction: column; gap: 45px; scroll-behavior: smooth;
        }

        /* MESSAGE STYLING */
        .msg-row { display: flex; gap: 20px; font-size: 16px; line-height: 1.7; animation: slideUp 0.3s ease; }
        .msg-row.user { flex-direction: row-reverse; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .avatar-circle { width: 32px; height: 32px; border-radius: 50%; flex-shrink: 0; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .content-box { max-width: 85%; }

        /* TYPING EFFECT */
        .cursor { display: inline-block; width: 8px; height: 18px; background: #fff; margin-left: 5px; animation: blink 0.8s infinite; vertical-align: middle; }
        @keyframes blink { 50% { opacity: 0; } }

        /* --- INPUT CONSOLE --- */
        .input-console {
            position: absolute; bottom: 35px; left: 50%; transform: translateX(-50%);
            width: 70%; max-width: 850px; background: #1e1f20; border-radius: 32px;
            padding: 12px 25px; display: flex; align-items: center; gap: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3); border: 1px solid #333;
        }
        #user-prompt {
            flex: 1; background: none; border: none; color: #fff;
            font-size: 16px; outline: none; resize: none; max-height: 200px;
        }
        .console-icons { display: flex; gap: 20px; color: #c4c7c5; font-size: 22px; cursor: pointer; }
        .mic-active { color: var(--blue); animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        @media (max-width: 768px) {
            .input-console { width: 92%; bottom: 20px; }
            #chat-area { padding: 20px 20px 150px; }
        }
    </style>
</head>
<body>

    <div id="side-nav">
        <div class="btn-new-chat" onclick="location.reload()">
            <span style="font-size:20px;">Ôºã</span> <span>New chat</span>
        </div>
        <div class="chat-history" id="history-list">
            <div id="guest-info" style="padding:15px; font-size:12px; color:#888;">Log in to keep your chat history.</div>
        </div>
        <div style="padding:10px; font-size:11px; color:#555; border-top:1px solid #333; text-align:center;">
            Killer King Edition
        </div>
    </div>

    <div class="main-view">
        <header>
            <div style="display:flex; align-items:center; gap:15px;">
                <div style="font-size:24px; cursor:pointer; padding:5px;" onclick="document.getElementById('side-nav').classList.toggle('collapsed')">‚ò∞</div>
                <div class="logo-box">
                    Gemini <img src="https://www.gstatic.com/lamda/images/gemini_sparkle_v002_d4735304ef622916b.svg" class="gemini-sparkle">
                </div>
            </div>
            <div id="auth-box">
                <button class="auth-btn" onclick="signIn()">Sign in</button>
                <img src="" id="pfp-img" class="user-pfp" onclick="signOutUser()">
            </div>
        </header>

        <div id="chat-area">
            <div id="welcome-msg" style="margin-top:100px;">
                <h1 style="font-size:42px; font-weight:400; color:#444746;">Hello, <span id="user-name-tag">Guest</span></h1>
                <p style="font-size:24px; color:#444746;">I'm your Gemini AI. How can I help?</p>
            </div>
        </div>

        <div class="input-console">
            <textarea id="user-prompt" placeholder="Enter a prompt here" rows="1" oninput="this.style.height='auto';this.style.height=this.scrollHeight+'px'"></textarea>
            <div class="console-icons">
                <div id="mic-icon" onclick="startVoice()">üéôÔ∏è</div>
                <div onclick="executeAI()" style="color:var(--blue)">‚û§</div>
            </div>
        </div>
    </div>

    <script>
        // FIREBASE SETUP
        const firebaseConfig = {
            apiKey: "AIzaSyA0R7a03Habu9c-fRnlJgXRtOkUUBRXBYk",
            authDomain: "myaicoder-6ce7a.firebaseapp.com",
            projectId: "myaicoder-6ce7a",
            storageBucket: "myaicoder-6ce7a.firebasestorage.app",
            messagingSenderId: "1035663178472",
            appId: "1:1035663178472:web:3b6f72e4cc6e2a48c2275d"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const KEY = "AIzaSyDQhm4nMj3tovusetemxq1dLaAyii7NfH4";

        let activeUser = null;

        // AUTH LOGIC
        function signIn() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
        function signOutUser() { if(confirm("Logout?")) auth.signOut().then(()=>location.reload()); }

        auth.onAuthStateChanged(user => {
            if(user) {
                activeUser = user;
                document.querySelector('.auth-btn').style.display = 'none';
                const pfp = document.getElementById('pfp-img');
                pfp.src = user.photoURL;
                pfp.style.display = 'block';
                document.getElementById('user-name-tag').innerText = user.displayName.split(' ')[0];
                document.getElementById('guest-info').style.display = 'none';
                loadHistory();
            }
        });

        // AI ENGINE
        async function executeAI() {
            const field = document.getElementById('user-prompt');
            const query = field.value.trim();
            if(!query) return;

            document.getElementById('welcome-msg').style.display = 'none';
            addBubble('user', query);
            field.value = "";
            field.style.height = "auto";

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${KEY}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ contents: [{ parts: [{ text: query }] }] })
                });
                const data = await response.json();
                const aiResponse = data.candidates[0].content.parts[0].text;
                
                addBubble('ai', aiResponse);

                if(activeUser) {
                    db.collection("full_gemini_chats").add({
                        uid: activeUser.uid, prompt: query, res: aiResponse, time: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
            } catch(e) { addBubble('ai', "Neural link error. Please retry."); }
        }

        function addBubble(role, text) {
            const area = document.getElementById('chat-area');
            const row = document.createElement('div');
            row.className = `msg-row ${role}`;
            
            const icon = role === 'user' ? 
                `<img src="${activeUser ? activeUser.photoURL : 'https://cdn-icons-png.flaticon.com/512/149/149071.png'}" style="width:100%">` : 
                `<img src="https://www.gstatic.com/lamda/images/gemini_sparkle_v002_d4735304ef622916b.svg" style="width:24px">`;

            row.innerHTML = `
                <div class="avatar-circle">${icon}</div>
                <div class="content-box">
                    <div class="text-payload"></div>
                    ${role === 'ai' ? `<div style="margin-top:12px; font-size:12px; color:#aaa; cursor:pointer" onclick="speak(this)">üîä Listen</div>` : ''}
                </div>
            `;
            area.appendChild(row);

            const payload = row.querySelector('.text-payload');
            if(role === 'ai') {
                let i = 0;
                const speed = 5;
                const timer = setInterval(() => {
                    if(i < text.length) {
                        payload.innerHTML = text.substring(0, i+1) + '<span class="cursor"></span>';
                        i++;
                        area.scrollTop = area.scrollHeight;
                    } else {
                        payload.innerHTML = text; // Final Clean
                        clearInterval(timer);
                    }
                }, speed);
            } else { payload.innerText = text; }
            area.scrollTop = area.scrollHeight;
        }

        // UTILITIES
        function speak(btn) {
            const txt = btn.previousElementSibling.innerText;
            const synth = window.speechSynthesis;
            const utter = new SpeechSynthesisUtterance(txt);
            utter.lang = 'hi-IN';
            synth.speak(utter);
        }

        function startVoice() {
            const rec = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            const mic = document.getElementById('mic-icon');
            rec.lang = 'hi-IN';
            rec.start();
            mic.classList.add('mic-active');
            rec.onresult = (e) => {
                mic.classList.remove('mic-active');
                document.getElementById('user-prompt').value = e.results[0][0].transcript;
                executeAI();
            };
            rec.onerror = () => mic.classList.remove('mic-active');
        }

        function loadHistory() {
            db.collection("full_gemini_chats").where("uid","==",activeUser.uid).orderBy("time","desc").limit(10).onSnapshot(s => {
                const list = document.getElementById('history-list');
                list.innerHTML = "";
                s.forEach(doc => {
                    const d = doc.data();
                    const el = document.createElement('div');
                    el.className = 'history-item';
                    el.innerHTML = `<span>üí¨</span> ${d.prompt}`;
                    el.onclick = () => {
                        document.getElementById('welcome-msg').style.display = 'none';
                        addBubble('user', d.prompt);
                        addBubble('ai', d.res);
                    };
                    list.appendChild(el);
                });
            });
        }
    </script>
</body>
</html>
